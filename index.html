<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DashBox MCPE - ItsDonline</title>

<style>
:root{--orange:#FF8C00}
body{margin:0;font-family:sans-serif;background:#fdfdfd;padding-bottom: 60px; overflow-x: hidden;}

/* NAVBAR WITH HELP BUTTON */
.navbar{background:var(--orange);padding:15px;color:#fff;font-weight:bold;text-align:center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: center; align-items: center; position: relative;}
.help-main-btn { position: absolute; right: 15px; cursor: pointer; font-size: 20px; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 8px; transition: 0.3s; }
.help-main-btn:hover { background: rgba(255,255,255,0.4); }

.container{padding:20px;max-width:450px;margin:auto}
.card{background:#fff;padding:25px;border-radius:20px;box-shadow:0 4px 10px rgba(0,0,0,.05);text-align:center}
.btn{width:100%;background:var(--orange);color:#fff;border:none;padding:14px;border-radius:12px;font-weight:bold;cursor:pointer;margin-top:10px; transition: 0.3s;}
.btn:active{transform: scale(0.98); opacity: 0.9;}

/* OWNER PANEL */
.owner-panel{display:none;background:#fff9f0;padding:20px;border-radius:15px;border:2px dashed var(--orange);margin-bottom:20px}
.file-item{display:flex;align-items:center;background:#fff;border:1px solid #eee;padding:12px;border-radius:12px;margin-bottom:10px}
.file-info{flex:1;text-align:left}
.file-btn{width:auto;padding:8px 12px;margin-left:5px;font-size:12px}

/* HELP MODAL */
#helpModal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
.modal-content { background: #fff; margin: 10% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 400px; position: relative; max-height: 70vh; overflow-y: auto; }
.close-modal { position: absolute; right: 15px; top: 10px; font-size: 24px; cursor: pointer; color: #888; }
.help-item { text-align: left; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
.help-item b { color: var(--orange); display: block; margin-bottom: 5px; }

/* CHAT SYSTEM */
#chatBox{position:fixed;bottom:20px;right:20px;width:280px;background:#fff;border:2px solid var(--orange);border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.2);overflow:hidden;display:flex;flex-direction:column;height:300px;z-index:1000; touch-action: none;}
#chatHeader{background:var(--orange);color:#fff;padding:10px;font-weight:bold;text-align:center;position:relative;cursor: grab; user-select: none; display: flex; justify-content: center; align-items: center;}
#adminChatBtn{position:absolute; right:10px; cursor:pointer; display:none;}
#chatMessages{flex:1;padding:10px;overflow-y:auto;font-size:13px; background: #fff;}
#chatInputBox{display:flex;border-top:1px solid #eee}
#chatInputBox input{flex:1;padding:10px;border:none;outline:none}
#chatInputBox button{padding:10px;background:var(--orange);color:#fff;border:none; cursor: pointer;}

/* FOLDER SYSTEM */
.folder-header{background:#f0f0f0;padding:10px;border-radius:8px;margin-bottom:10px;cursor:pointer;font-weight:bold;color:#333;border:1px solid #ddd; display: flex; justify-content: space-between; align-items: center;}
.folder-content{display:none;padding-left:10px; margin-bottom: 15px;}
.folder-content.show{display:block;}

.footer-left {position: fixed; bottom: 10px; left: 10px; font-size: 13px; color: #888; z-index: 999; pointer-events: none;}
</style>
</head>
<body>

<div id="helpModal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeHelp()">&times;</span>
    <h3 style="color:var(--orange); text-align:center;">User Guide</h3>
    
    <div class="help-item">
      <b>1. How to Sign In</b>
      Enter your Username, Password, and the Key (itsdonline) to access your dashboard.
    </div>
    <div class="help-item">
      <b>2. Public & Private Files</b>
      Files in 'Public' can be seen by everyone. Files in 'My Files' are your personal storage.
    </div>
    <div class="help-item">
      <b>3. Creating Folders (Owner Only)</b>
      If you are the admin, use the Owner Panel to create new folders to organize files.
    </div>
    <div class="help-item">
      <b>4. Uploading Files</b>
      Select a folder first, then click 'Upload File'.
    </div>
    <div class="help-item">
      <b>5. Chat Box</b>
      You can drag the chat header to move it. Type a message and press Enter or 'Kirim' to send.
    </div>
    
    <button class="btn" onclick="closeHelp()">Got it!</button>
  </div>
</div>

<div class="navbar">
  DashBox Cloud
  <div class="help-main-btn" onclick="openHelp()">‚ùì</div>
</div>

<div class="container">

 <div id="loginBox" class="card">
  <h2 style="color:var(--orange)">SIGN IN</h2>
  <input id="username" placeholder="Username" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;box-sizing:border-box">
  <input id="userpass" type="password" placeholder="Password Pribadi" style="width:100%;padding:12px;margin-top:10px;border-radius:10px;border:1px solid #ddd;box-sizing:border-box">
  <input id="userkey" type="password" placeholder="Key DashBox: itsdonline" style="width:100%;padding:12px;margin-top:10px;border-radius:10px;border:1px solid #ddd;box-sizing:border-box">
  
  <div class="key-info" style="margin-top: 10px; font-size: 12px;">üîë <b>Key From:</b> itsdonline di channel youtube</div>
  <button class="btn" onclick="doLogin()">SIGN IN</button>
 </div>

 <div id="dashboard" style="display:none">
  <div id="adminPanel" class="owner-panel">
   <b>OWNER PANEL</b><br><br>
   <input id="newFolderName" placeholder="Nama Folder Baru" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-bottom:10px; box-sizing: border-box;">
   <button class="btn" onclick="addFolder()">TAMBAH FOLDER</button><br><br>
   
   <input type="file" id="fileInput" hidden onchange="startUpload()">
   <select id="folderSelect" style="width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-bottom:10px;">
    <option value="">Pilih Folder untuk Upload</option>
   </select>
   <button class="btn" onclick="fileInput.click()">UPLOAD FILE</button>
  </div>

  <button class="btn" style="background:#888; margin-bottom:20px;" onclick="logout()">LOGOUT</button>
  <div id="list"></div>
 </div>

 <div id="chatBox">
  <div id="chatHeader">
    üí¨ Chat
    <span id="adminChatBtn" onclick="clearChat()">üóëÔ∏è</span>
  </div>
  <div id="chatMessages"></div>
  <div id="chatInputBox">
    <input id="chatInput" placeholder="Pesan..." onkeypress="if(event.key==='Enter')sendMessage()"/>
    <button onclick="sendMessage()">Kirim</button>
  </div>
 </div>

</div>

<div class="footer-left">by : <b style="color:#FF8C00">donline</b></div>

<script>
let publicFiles = JSON.parse(localStorage.getItem("publicFiles") || "{}");
let userFiles   = JSON.parse(localStorage.getItem("userFiles") || "{}");
let chatData    = JSON.parse(localStorage.getItem("chatData") || "[]");
let accounts    = JSON.parse(localStorage.getItem("accounts") || "{}");
let chatPos     = JSON.parse(localStorage.getItem("chatPos") || '{"x": "auto", "y": "auto"}');

if (!accounts["donline"]) {
    accounts["donline"] = "Ara*1102*Rck";
    userFiles["donline"] = [];
}

let currentUser = "";
let isAdmin = false;

function openHelp() { document.getElementById('helpModal').style.display = 'block'; }
function closeHelp() { document.getElementById('helpModal').style.display = 'none'; }

const chatBox = document.getElementById('chatBox');
if (chatPos.x !== "auto") {
  chatBox.style.left = chatPos.x + "px";
  chatBox.style.top = chatPos.y + "px";
  chatBox.style.bottom = "auto";
  chatBox.style.right = "auto";
}

function saveAll(){
 localStorage.setItem("publicFiles", JSON.stringify(publicFiles));
 localStorage.setItem("userFiles", JSON.stringify(userFiles));
 localStorage.setItem("chatData", JSON.stringify(chatData));
 localStorage.setItem("accounts", JSON.stringify(accounts));
 localStorage.setItem("chatPos", JSON.stringify(chatPos));
}

function doLogin(){
 const u = document.getElementById('username').value.trim();
 const p = document.getElementById('userpass').value.trim();
 const k = document.getElementById('userkey').value.trim().toLowerCase();
 if(k !== "itsdonline"){ alert("Invalid Key!"); return; }
 if(!u || !p){ alert("Please fill all fields!"); return; }

 if(accounts[u]) {
    if(accounts[u] !== p) { alert("‚ùå Wrong password!"); return; }
 } else {
    accounts[u] = p;
    userFiles[u] = [];
    alert("‚úÖ Account registered!");
 }
 currentUser = u;
 if(u.toLowerCase() === "donline"){
  isAdmin = true;
  document.getElementById('adminPanel').style.display="block";
  document.getElementById("adminChatBtn").style.display="inline";
  updateFolderSelect();
 }
 saveAll();
 document.getElementById('loginBox').style.display="none";
 document.getElementById('dashboard').style.display="block";
 renderFiles();
 renderChat();
}

function logout(){ location.reload(); }

function addFolder(){
 const folderName = document.getElementById('newFolderName').value.trim();
 if(!folderName){ alert("Name cannot be empty!"); return; }
 if(publicFiles[folderName]){ alert("Folder exists!"); return; }
 publicFiles[folderName] = [];
 document.getElementById('newFolderName').value = "";
 saveAll();
 updateFolderSelect();
 renderFiles();
}

function updateFolderSelect(){
 const folderSelect = document.getElementById('folderSelect');
 folderSelect.innerHTML = '<option value="">Select Folder</option>';
 Object.keys(publicFiles).forEach(f => {
  folderSelect.innerHTML += `<option value="${f}">${f}</option>`;
 });
}

function startUpload(){
 const fileInput = document.getElementById('fileInput');
 const f = fileInput.files[0];
 if(!f) return;
 const selectedFolder = document.getElementById('folderSelect').value;
 if(!selectedFolder){ alert("Select a folder first!"); return; }

 const reader=new FileReader();
 reader.onload=e=>{
  const data={name:f.name,size:(f.size/1024).toFixed(1)+" KB",data:e.target.result};
  publicFiles[selectedFolder].push(data);
  saveAll();
  renderFiles();
  alert("File Uploaded!");
 }
 reader.readAsDataURL(f);
}

function renderFiles(){
 const list = document.getElementById('list');
 list.innerHTML="<h4 style='color:#555'>üåê Public Files</h4>";
 Object.keys(publicFiles).forEach(folder => {
  const files = publicFiles[folder];
  list.innerHTML += `
    <div class="folder-header" onclick="toggleFolder('${folder}')">
      <span>üìÅ ${folder} (${files.length})</span>
      ${isAdmin ? `<button onclick="event.stopPropagation(); removeFolder('${folder}')" style="background:red; color:#fff; border:none; padding:4px 8px; border-radius:5px;">Delete</button>` : ''}
    </div>
    <div class="folder-content" id="folder-${folder}">
      ${files.map((f,i)=>fileBox(f,`downloadFile(publicFiles['${folder}'][${i}])`,isAdmin?`removePublic('${folder}',${i})`:"")).join('')}
    </div>`;
 });
 list.innerHTML+="<h4 style='color:#555'>üë§ My Files</h4>";
 (userFiles[currentUser]||[]).forEach((f,i)=>list.innerHTML+=fileBox(f,`downloadFile(userFiles['${currentUser}'][${i}])`,`removePrivate(${i})`));
}

function toggleFolder(f){ document.getElementById(`folder-${f}`).classList.toggle('show'); }

function removeFolder(folder){
 if(confirm(`Delete "${folder}"?`)){ delete publicFiles[folder]; saveAll(); updateFolderSelect(); renderFiles(); }
}

function fileBox(f,d,del){
 return `<div class="file-item"><div class="file-info"><b>${f.name}</b><br><small>${f.size}</small></div><button class="btn file-btn" onclick="${d}">SAVE</button>${del?`<button class="btn file-btn" style="background:red" onclick="${del}">X</button>`:""}</div>`;
}

function removePublic(folder,i){ publicFiles[folder].splice(i,1); saveAll(); renderFiles(); }
function removePrivate(i){ userFiles[currentUser].splice(i,1); saveAll(); renderFiles(); }

async function downloadFile(f){
 try {
  const res = await fetch(f.data);
  const blob = await res.blob();
  const file = new File([blob], f.name, {type: blob.type});
  if(navigator.canShare && navigator.canShare({files:[file]})) await navigator.share({files:[file]});
  else { const a=document.createElement("a"); a.href=f.data; a.download=f.name; a.click(); }
 } catch(e) { alert("Download failed."); }
}

function sendMessage(){
 const chatInput = document.getElementById('chatInput');
 if(!chatInput.value.trim()) return;
 chatData.push({u:currentUser || "Guest", t:chatInput.value});
 chatInput.value=""; saveAll(); renderChat();
}

function renderChat(){
 const chatMessages = document.getElementById('chatMessages');
 chatMessages.innerHTML = chatData.map((m,i)=>`
  <div class="message"><b>${m.u}</b>: ${m.t} ${isAdmin ? `<span onclick="deleteChat(${i})" style="color:red; cursor:pointer;">‚úñ</span>` : ``}</div>
 `).join('');
 chatMessages.scrollTop = chatMessages.scrollHeight;
}

function clearChat(){ if(confirm("Clear all chat?")){ chatData = []; saveAll(); renderChat(); } }
function deleteChat(i){ chatData.splice(i,1); saveAll(); renderChat(); }

// --- DRAG LOGIC ---
let isDragging = false;
let offsetX, offsetY;

function startDrag(e) {
  const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
  const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
  isDragging = true;
  offsetX = clientX - chatBox.offsetLeft;
  offsetY = clientY - chatBox.offsetTop;
}
function onDrag(e) {
  if (!isDragging) return;
  if (e.type === 'touchmove') e.preventDefault();
  const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
  const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
  let x = clientX - offsetX;
  let y = clientY - offsetY;
  x = Math.max(0, Math.min(x, window.innerWidth - chatBox.offsetWidth));
  y = Math.max(0, Math.min(y, window.innerHeight - chatBox.offsetHeight));
  chatBox.style.left = x + 'px';
  chatBox.style.top = y + 'px';
  chatBox.style.right = 'auto';
  chatBox.style.bottom = 'auto';
  chatPos = {x, y};
}
function stopDrag() { isDragging = false; saveAll(); }

document.getElementById('chatHeader').addEventListener('mousedown', startDrag);
document.addEventListener('mousemove', onDrag);
document.addEventListener('mouseup', stopDrag);
document.getElementById('chatHeader').addEventListener('touchstart', startDrag, { passive: false });
document.addEventListener('touchmove', onDrag, { passive: false });
document.addEventListener('touchend', stopDrag);

renderChat();
</script>
</body>
</html>